Homework 6
================
Wenhao Gou
2020/12/8

## Question 1:

### Clean and tidy the dataset:

Firstly, create and clean the dataset we need to use in further
analysis:

``` r
homicide_clean = 
  read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) %>% 
  mutate(
    city_state = str_c(city, state, sep = ", "),
    victim_age = as.numeric(victim_age),
    resolution = case_when(
      disposition == "Closed without arrest" ~ 0,
      disposition == "Open/No arrest"        ~ 0,
      disposition == "Closed by arrest"      ~ 1)
  ) %>% 
  filter(
    victim_race %in% c("White", "Black"),
    city_state != "Tulsa, AL",
    city_state != "Dallas, TX",
    city_state != "Phoenix, AZ",
    city_state != "Kansas City, MO") %>% 
  select(city_state, resolution, victim_age, victim_race, victim_sex)
```

### Logsictic regression on Baltimore, MD

``` r
model_Baltimore <-
  homicide_clean %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(resolution ~ victim_age + victim_race + victim_sex, 
      data = .,
      family = binomial())  
  
result_Baltimore <- 
  model_Baltimore %>% 
  broom::tidy() %>% 
  mutate(
    odd_ratio = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(term, odd_ratio , starts_with("CI")) %>% 
  knitr::kable(digits = 3)
```

### Logistic regression on all cities:

``` r
result_all <-
  homicide_clean %>% 
  nest(glm_data = -city_state) %>% 
  mutate(model = map(.x =glm_data, ~glm(resolution ~ victim_age + victim_race + victim_sex, 
                                   data =.x,
                                   family = binomial())),
         result = map(model,broom::tidy)) %>% 
  select(city_state, result) %>% 
  unnest(result) %>% 
  mutate(
    odd_ratio = exp(estimate),
    CI_lower = exp(estimate - 1.96 * std.error),
    CI_upper = exp(estimate + 1.96 * std.error)
  ) %>% 
  select(city_state, term, odd_ratio, starts_with("CI")) 
```

### Plots of odd ratio and CIs:

``` r
result_all %>% 
  filter(term == "victim_sexMale") %>% 
  mutate(city_state = fct_reorder(city_state, odd_ratio )) %>% 
  ggplot(aes(x = city_state, y = odd_ratio)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = CI_lower, ymax = CI_upper)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

![](p8105_hw6_wg2364_files/figure-gfm/Plots%20of%20odd%20ratio%20and%20CIs-1.png)<!-- -->

## Quesiton 2:

### Import and tidy the data

``` r
#Read and clean the data:
child_df <-
  read_csv("./data/birthweight.csv") %>% 
  mutate(babysex = as.factor(babysex),
         frace = as.factor(frace),
         mrace = as.factor(mrace),
         malform = as.factor(malform))

#Check and initial explore of the dataset
skimr::skim(child_df) 
```

|                                                  |           |
| :----------------------------------------------- | :-------- |
| Name                                             | child\_df |
| Number of rows                                   | 4342      |
| Number of columns                                | 20        |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |           |
| Column type frequency:                           |           |
| factor                                           | 4         |
| numeric                                          | 16        |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |           |
| Group variables                                  | None      |

Data summary

**Variable type: factor**

| skim\_variable | n\_missing | complete\_rate | ordered | n\_unique | top\_counts                     |
| :------------- | ---------: | -------------: | :------ | --------: | :------------------------------ |
| babysex        |          0 |              1 | FALSE   |         2 | 1: 2230, 2: 2112                |
| frace          |          0 |              1 | FALSE   |         5 | 1: 2123, 2: 1911, 4: 248, 3: 46 |
| malform        |          0 |              1 | FALSE   |         2 | 0: 4327, 1: 15                  |
| mrace          |          0 |              1 | FALSE   |         4 | 1: 2147, 2: 1909, 4: 243, 3: 43 |

**Variable type: numeric**

| skim\_variable | n\_missing | complete\_rate |    mean |     sd |      p0 |     p25 |     p50 |     p75 |   p100 | hist  |
| :------------- | ---------: | -------------: | ------: | -----: | ------: | ------: | ------: | ------: | -----: | :---- |
| bhead          |          0 |              1 |   33.65 |   1.62 |   21.00 |   33.00 |   34.00 |   35.00 |   41.0 | ▁▁▆▇▁ |
| blength        |          0 |              1 |   49.75 |   2.72 |   20.00 |   48.00 |   50.00 |   51.00 |   63.0 | ▁▁▁▇▁ |
| bwt            |          0 |              1 | 3114.40 | 512.15 |  595.00 | 2807.00 | 3132.50 | 3459.00 | 4791.0 | ▁▁▇▇▁ |
| delwt          |          0 |              1 |  145.57 |  22.21 |   86.00 |  131.00 |  143.00 |  157.00 |  334.0 | ▅▇▁▁▁ |
| fincome        |          0 |              1 |   44.11 |  25.98 |    0.00 |   25.00 |   35.00 |   65.00 |   96.0 | ▃▇▅▂▃ |
| gaweeks        |          0 |              1 |   39.43 |   3.15 |   17.70 |   38.30 |   39.90 |   41.10 |   51.3 | ▁▁▂▇▁ |
| menarche       |          0 |              1 |   12.51 |   1.48 |    0.00 |   12.00 |   12.00 |   13.00 |   19.0 | ▁▁▂▇▁ |
| mheight        |          0 |              1 |   63.49 |   2.66 |   48.00 |   62.00 |   63.00 |   65.00 |   77.0 | ▁▁▇▂▁ |
| momage         |          0 |              1 |   20.30 |   3.88 |   12.00 |   18.00 |   20.00 |   22.00 |   44.0 | ▅▇▂▁▁ |
| parity         |          0 |              1 |    0.00 |   0.10 |    0.00 |    0.00 |    0.00 |    0.00 |    6.0 | ▇▁▁▁▁ |
| pnumlbw        |          0 |              1 |    0.00 |   0.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.0 | ▁▁▇▁▁ |
| pnumsga        |          0 |              1 |    0.00 |   0.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.0 | ▁▁▇▁▁ |
| ppbmi          |          0 |              1 |   21.57 |   3.18 |   13.07 |   19.53 |   21.03 |   22.91 |   46.1 | ▃▇▁▁▁ |
| ppwt           |          0 |              1 |  123.49 |  20.16 |   70.00 |  110.00 |  120.00 |  134.00 |  287.0 | ▅▇▁▁▁ |
| smoken         |          0 |              1 |    4.15 |   7.41 |    0.00 |    0.00 |    0.00 |    5.00 |   60.0 | ▇▁▁▁▁ |
| wtgain         |          0 |              1 |   22.08 |  10.94 | \-46.00 |   15.00 |   22.00 |   28.00 |   89.0 | ▁▁▇▁▁ |

``` r
#Check the levels of factors:
unique(pull(child_df, babysex))
```

    ## [1] 2 1
    ## Levels: 1 2

``` r
unique(pull(child_df, frace))
```

    ## [1] 1 2 3 4 8
    ## Levels: 1 2 3 4 8

``` r
unique(pull(child_df, mrace))
```

    ## [1] 1 2 3 4
    ## Levels: 1 2 3 4

``` r
unique(pull(child_df, malform))
```

    ## [1] 0 1
    ## Levels: 0 1

We can see that, there are no missing data in the dataset. From the
glance of the data, focus on the continuous variable, we can see that
all the data entry in the variable `pnumlbw` (previous number of low
birth weight babies) and `pnumsga` (number of prior small for
gestational age babies) are zero, so we can drop these two variables.
For some variable that is highly skewed, like `parity` (number of live
births prior to this pregnancy) and `smoken` (average number of
cigarettes smoked per day during pregnancy), it may not be appropriate
to include the main model or should be treated as factors.

For discreet variables, we checked the level of them. Also, the variable
`malform` is highly skewed and may not be appropriate to included in the
meta analysis.

### Model building:

As the description above, we would like to use all the remaining
variabls. Also, some transformation need to be done:

``` r
#Fliter and transformable the data:
```

### Cross Validation:

## Question 3:
